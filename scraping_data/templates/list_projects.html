<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Liste des Projets Swagger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card {
      border-radius: 0.75rem;
      box-shadow: 0 0.125rem 0.5rem rgba(0,0,0,.1);
    }
    .endpoint-block {
      background: #f1f3f5;
      padding: 1rem;
      border-radius: 0.5rem;
      margin-bottom: 1rem;
    }
    code {
      color: #d63384;
    }

    .navbar-gradient {
      background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
      box-shadow: 0 4px 12px rgba(24, 40, 72, 0.3);
      padding: 0.8rem 1.5rem;
    }
    .navbar-brand svg path {
      fill: white;
    }
    .navbar-brand {
      font-size: 1.5rem;
      color: white !important;
    }
    .navbar-nav .nav-link {
      color: white !important;
      font-size: 1.05rem;
      font-weight: 600;
      transition: color 0.3s ease;
    }
    .navbar-nav .nav-link:hover {
      color: #ffd700 !important;
      text-decoration: underline;
    }
    .btn-light {
      font-weight: 600;
      transition: transform 0.25s ease;
    }
    .btn-light:hover {
      transform: scale(1.1);
      box-shadow: 0 0 8px rgba(255, 215, 0, 0.7);
    }
    .custom-toggler {
      border-color: transparent;
    }
    .custom-toggler .navbar-toggler-icon {
      background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba%28255, 255, 255, 1%29' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E");
    }
    .navbar-nav.ms-2 {
      margin-left: 0.5rem;
    }
    @media (max-width: 576px) {
      .navbar-gradient {
        padding: 0.6rem 1rem;
      }
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-gradient shadow-sm">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center fw-bold" href="#">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" class="me-2" viewBox="0 0 16 16">
        <path d="M8 0L3 16h10L8 0z"/>
      </svg>
      MyProject
    </a>

    <!-- ✅ Liens de navigation -->
    <ul class="navbar-nav d-flex flex-row align-items-center ms-2">
      <li class="nav-item">
        <a class="nav-link text-white fw-semibold" href="{% url 'scraping_data:list-projects' %}">Projects</a>
      </li>
      <li class="nav-item">
        <a class="nav-link text-white fw-semibold" href="{% url 'scraping_data:rapport-swagger-html' %}">Rapport</a>
      </li>
    </ul>

    <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarMain">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item mx-2">
          <a class="btn btn-light btn-sm px-4 rounded-pill shadow-sm" href="#">Get Started</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container py-5">

  <div class="mb-4 text-end">
    <a href="{% url 'scraping_data:add-project' %}" class="btn btn-success">
      + Ajouter un projet
    </a>
  </div>

  <h1 class="mb-4 text-primary">Liste des Projets Swagger</h1>

  {% if projets %}
    <div class="accordion" id="accordionProjects">
      {% for p in projets %}
        <div class="accordion-item mb-3">
          <h2 class="accordion-header" id="heading{{ p.id }}">
            <button class="accordion-button collapsed bg-primary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ p.id }}" aria-expanded="false" aria-controls="collapse{{ p.id }}">
              Projet #{{ p.id }} — Créé le {{ p.created_at|date:"Y-m-d H:i" }}
            </button>
          </h2>

          <!-- Boutons d’action -->
          <div class="px-4 py-2 bg-light border-top d-flex justify-content-end flex-wrap gap-2">
            <a href="{{ p.swagger_root_url }}" target="_blank" class="btn btn-dark btn-sm">
              Swagger
            </a>
            <a href="{% url 'scraping_data:rapport-swagger-html' %}?id={{ p.id }}" class="btn btn-outline-primary btn-sm">
              Projet
            </a>
            <!-- ✅ Nouveau bouton Tester -->
            <a href="{% url 'scraping_data:tester-page' %}" class="btn btn-warning btn-sm">
              Tester
            </a>
            <!-- ✅ Nouveau bouton Paramètres -->
            <a href="{% url 'scraping_data:project-parameters' p.id %}" class="btn btn-info btn-sm">
              Paramètres
            </a>

            <a href="{% url 'scraping_data:edit-project' p.id %}" class="btn btn-warning btn-sm">
              Modifier
            </a>

            <form action="{% url 'scraping_data:delete-project' p.id %}" method="post" onsubmit="return confirm('Voulez-vous vraiment supprimer ce projet ?');" class="d-inline">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm">Supprimer</button>
            </form>
          </div>

          <div id="collapse{{ p.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ p.id }}" data-bs-parent="#accordionProjects">
            <div class="accordion-body">
              <p><strong>URL Swagger :</strong>
                <a href="{{ p.swagger_url }}" target="_blank" class="link-primary">{{ p.swagger_url }}</a>
              </p>

              {% if p.swagger_json %}
                <p class="text-muted small">
                  Ce projet contient {{ p.swagger_json|length }} endpoints.
                </p>

                <div class="mb-3">
                  {% for ep in p.swagger_json %}
                    <div class="endpoint-block">
                      <h5>
                        <span class="badge
                          {% if ep.method|upper == 'GET' %} bg-success
                          {% elif ep.method|upper == 'POST' %} bg-primary
                          {% elif ep.method|upper == 'PUT' %} bg-warning text-dark
                          {% elif ep.method|upper == 'DELETE' %} bg-danger
                          {% else %} bg-secondary
                          {% endif %} me-2">
                          {{ ep.method|upper }}
                        </span>
                        {{ ep.endpoint }}
                      </h5>

                      {% if ep.summary %}
                        <p class="mb-2">{{ ep.summary }}</p>
                      {% endif %}

                      {% if ep.parameters %}
                        <ul class="list-group list-group-flush">
                          {% for param in ep.parameters %}
                            <li class="list-group-item">
                              <strong>{{ param.in }}</strong> →
                              <span class="text-primary">{{ param.name }}</span>
                              <span class="badge bg-light text-dark ms-2">{{ param.type }}</span>
                              {% if param.value %}
                                <span class="text-muted ms-2">Exemple : <code>{{ param.value }}</code></span>
                              {% endif %}
                            </li>
                          {% endfor %}
                        </ul>
                      {% else %}
                        <p class="text-muted mb-0">Aucun paramètre trouvé pour cet endpoint.</p>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <p class="text-muted">Aucun endpoint disponible pour ce projet.</p>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">Aucun projet Swagger enregistré.</p>
  {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
